<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Generative Adversarial Networks (GANs) and CycleGANs | ASR</title>
<meta name="keywords" content="Computer Vision, GANs, CycleGANs, Deep Learning">
<meta name="description" content="Exploration of GANs and CycleGANs.">
<meta name="author" content="">
<link rel="canonical" href="https://adilsarsenov.dev/posts/gans/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.min.a72801f0f40a8d7f71aa1cafd1c2f2a993a1f26ca1cfd38fdba65d5b9b0f08a0.css" integrity="sha256-pygB8PQKjX9xqhyv0cLyqZOh8myhz9OP26ZdW5sPCKA=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.min.b95bacdc39e37a332a9f883b1e78be4abc1fdca2bc1f2641f55e3cd3dabd4d61.js" integrity="sha256-uVus3DnjejMqn4g7Hni&#43;Srwf3KK8HyZB9V4809q9TWE="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://adilsarsenov.dev/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://adilsarsenov.dev/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://adilsarsenov.dev/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://adilsarsenov.dev/apple-touch-icon.png">
<link rel="mask-icon" href="https://adilsarsenov.dev/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="Generative Adversarial Networks (GANs) and CycleGANs" />
<meta property="og:description" content="Exploration of GANs and CycleGANs." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://adilsarsenov.dev/posts/gans/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-05-01T18:34:44&#43;05:00" />
<meta property="article:modified_time" content="2024-05-01T18:34:44&#43;05:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Generative Adversarial Networks (GANs) and CycleGANs"/>
<meta name="twitter:description" content="Exploration of GANs and CycleGANs."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://adilsarsenov.dev/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Generative Adversarial Networks (GANs) and CycleGANs",
      "item": "https://adilsarsenov.dev/posts/gans/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Generative Adversarial Networks (GANs) and CycleGANs",
  "name": "Generative Adversarial Networks (GANs) and CycleGANs",
  "description": "Exploration of GANs and CycleGANs.",
  "keywords": [
    "Computer Vision", "GANs", "CycleGANs", "Deep Learning"
  ],
  "articleBody": "Introduction Generative Adversarial Networks (GANs) have emerged as a groundbreaking approach in generative modeling using deep learning techniques. Introduced by Ian Goodfellow and his colleagues in 2014, GANs have revolutionized the way we generate synthetic data.\nWhat are GANs? Generative Adversarial Networks (GANs) designed to generate realistic data by training two neural networks, the generator and the discriminator, in a competitive setting. The generator creates synthetic data, while the discriminator evaluates the authenticity of the data, distinguishing between real and fake samples.\nComponents of GANs Generator: This network generates new data instances that resemble the training data. Discriminator: This network evaluates the authenticity of the data, distinguishing between real and generated instances. The generator aims to produce data that is indistinguishable from real data, while the discriminator tries to identify whether the data is real or generated. The two networks are trained together in a zero-sum game, improving each other iteratively.\nStructure of GANs GANs consist of two main parts:\nGenerative: The generator takes random noise as input and generates synthetic data. Adversarial: The discriminator tries to distinguish between real data and synthetic data produced by the generator. Mathematical Formulation The training of GANs involves the following objective functions for the generator and discriminator:\nDiscriminator Loss: $$ L_D = - \\mathbb{E}_{x \\sim p_d(x)}[\\log D(x)] - $$\n$$ \\mathbb{E}_{z \\sim p_z(z)}[\\log (1 - D(G(z)))] $$\nGenerator Loss: $$ L_G = - \\mathbb{E}_{z \\sim p_z(z)}[\\log D(G(z))] $$ where:\n( $D(x)$ ) is the discriminator’s estimate of the probability that real data instance ( $x$ ) is real. ( $G(z)$ ) is the generator’s output given noise ( $z$ ). ( $p_{d}(x)$ ) is the real data distribution. ( $p_z(z)$ ) is the prior distribution on input noise variables. Consider a simple GAN to generate handwritten digits similar to the MNIST dataset:\nGenerator Network: Takes random noise as input and generates a 28x28 image. Discriminator Network: Takes a 28x28 image as input and outputs a probability score indicating whether the image is real or fake. The networks are trained iteratively:\nTrain the discriminator on real and fake images. Train the generator to produce images that can fool the discriminator. CycleGAN CycleGANs are a variant of GANs designed for image-to-image translation without requiring paired examples. They are particularly useful for tasks where paired training data is unavailable.\nStructure of CycleGANs CycleGANs consist of two sets of generators and discriminators:\nGenerators: $( G: X \\to Y )$ and $( F: Y \\to X )$ Discriminators: $( D_Y )$ and $( D_X )$, which evaluate the realism of generated images. Loss Functions in CycleGANs Adversarial Loss: $$ L_{GAN}(G, D_Y, X, Y) = \\mathbb{E}_{y \\sim p_d(y)}[\\log (D_Y(y))] + $$\n$$ \\mathbb{E}_{x \\sim p_d(x)}[\\log (1 - D_Y(G(x)))] $$\nCycle-Consistency Loss: $$ L_{cyc}(G, F) = \\mathbb{E}_{x \\sim p_d(x)}[| F(G(x)) - x |_1] + $$\n$$ \\mathbb{E}_{y \\sim p_d(y)}[| G(F(y)) - y |_1] $$\nTotal Loss: $$ L(G, F, D_X, D_Y) = L_{GAN}(G, D_Y, X, Y) + L_{GAN}(F, D_X, Y, X) + \\lambda L_{cyc}(G, F) $$ where $( \\lambda )$ is a weight parameter that balances the two loss functions.\nExample Consider translating images from the domain of horses to the domain of zebras:\nGenerator $( G )$: Transforms horse images to zebra images. Generator $( F )$: Transforms zebra images to horse images. Discriminator $( D_Y )$: Evaluates whether an image is a real zebra or generated by $( G )$. Discriminator $( D_X )$: Evaluates whether an image is a real horse or generated by $( F )$. The training process involves:\nMinimizing the adversarial loss to ensure the generated images are indistinguishable from real images. Minimizing the cycle-consistency loss to ensure the content of the images is preserved during the translation. ",
  "wordCount" : "614",
  "inLanguage": "en",
  "datePublished": "2024-05-01T18:34:44.165668+05:00",
  "dateModified": "2024-05-01T18:34:44.165668+05:00",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://adilsarsenov.dev/posts/gans/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "ASR",
    "logo": {
      "@type": "ImageObject",
      "url": "https://adilsarsenov.dev/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top"><script>
  window.MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      displayMath: [['$$', '$$'], ['\\[', '\\]']],
      processEscapes: true,
      processEnvironments: true
    },
    svg: {
      fontCache: 'global'
    }
  };
</script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header sticky-header">
    <nav class="nav">
        <div class="logo">
            <a href="https://adilsarsenov.dev/" accesskey="h" title="ASR (Alt + H)">ASR</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </span>
        </div>
        <ul id="menu">
            <li>
                <a href="https://adilsarsenov.dev/" title="Home">
                    <span>Home</span>
                </a>
            </li>
            <li>
                <a href="https://adilsarsenov.dev/posts" title="Posts">
                    <span>Posts</span>
                </a>
            </li>
            <li>
                <a href="https://adilsarsenov.dev/archives" title="Archive">
                    <span>Archive</span>
                </a>
            </li>
            <li>
                <a href="https://adilsarsenov.dev/search" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
            <li>
                <a href="https://adilsarsenov.dev/tags" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://adilsarsenov.dev/">Home</a>&nbsp;»&nbsp;<a href="https://adilsarsenov.dev/posts/">Posts</a></div>
    <h1 class="post-title">
      Generative Adversarial Networks (GANs) and CycleGANs
    </h1>
    <div class="post-description">
      Exploration of GANs and CycleGANs.
    </div>
    <div class="post-meta">


Date: 01 May, 2024

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">‎ Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#introduction" aria-label="Introduction">Introduction</a></li>
                <li>
                    <a href="#what-are-gans" aria-label="What are GANs?">What are GANs?</a><ul>
                        
                <li>
                    <a href="#components-of-gans" aria-label="Components of GANs">Components of GANs</a></li>
                <li>
                    <a href="#structure-of-gans" aria-label="Structure of GANs">Structure of GANs</a></li>
                <li>
                    <a href="#mathematical-formulation" aria-label="Mathematical Formulation">Mathematical Formulation</a></li></ul>
                </li>
                <li>
                    <a href="#cyclegan" aria-label="CycleGAN">CycleGAN</a><ul>
                        
                <li>
                    <a href="#structure-of-cyclegans" aria-label="Structure of CycleGANs">Structure of CycleGANs</a></li>
                <li>
                    <a href="#loss-functions-in-cyclegans" aria-label="Loss Functions in CycleGANs">Loss Functions in CycleGANs</a></li>
                <li>
                    <a href="#example" aria-label="Example">Example</a>
                </li>
            </ul>
            </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h3 id="introduction">Introduction<a hidden class="anchor" aria-hidden="true" href="#introduction">#</a></h3>
<p>Generative Adversarial Networks <strong>(GANs)</strong> have emerged as a groundbreaking approach in generative modeling using deep learning techniques.
Introduced by <strong>Ian Goodfellow and his colleagues in 2014</strong>, GANs have revolutionized the way we generate synthetic data.</p>
<h3 id="what-are-gans">What are GANs?<a hidden class="anchor" aria-hidden="true" href="#what-are-gans">#</a></h3>
<p>Generative Adversarial Networks (GANs) designed to generate realistic data by <strong>training two neural networks, the generator and the discriminator,
in a competitive setting</strong>. The generator creates synthetic data, while the discriminator evaluates the authenticity of the data,
<strong>distinguishing between real and fake samples</strong>.</p>
<h4 id="components-of-gans">Components of GANs<a hidden class="anchor" aria-hidden="true" href="#components-of-gans">#</a></h4>
<ol>
<li><strong>Generator</strong>: This network generates new data instances that resemble the training data.</li>
</ol>
<p><img loading="lazy" src="/posts/gans/img1.png" alt="Generator"  />
</p>
<ol start="2">
<li><strong>Discriminator</strong>: This network evaluates the authenticity of the data, distinguishing between real and generated instances.</li>
</ol>
<p><img loading="lazy" src="/posts/gans/img2.png" alt="Discriminator"  />
</p>
<p>The generator aims to produce data that is <strong>indistinguishable from real data</strong>, while the <strong>discriminator tries to identify whether
the data is real or generated</strong>. The two networks are trained together in a zero-sum game, improving each other iteratively.</p>
<p><img loading="lazy" src="/posts/gans/img3.png" alt="DiscriminatorFub"  />
</p>
<h4 id="structure-of-gans">Structure of GANs<a hidden class="anchor" aria-hidden="true" href="#structure-of-gans">#</a></h4>
<p>GANs consist of two main parts:</p>
<ul>
<li><strong>Generative</strong>: The generator takes random noise as input and generates synthetic data.</li>
</ul>
<p><img loading="lazy" src="/posts/gans/img4.png" alt="Generative"  />
</p>
<ul>
<li><strong>Adversarial</strong>: The discriminator tries to distinguish between real data and synthetic data produced by the generator.</li>
</ul>
<p><img loading="lazy" src="/posts/gans/img5.png" alt="Adversarial"  />
</p>
<h4 id="mathematical-formulation">Mathematical Formulation<a hidden class="anchor" aria-hidden="true" href="#mathematical-formulation">#</a></h4>
<p>The training of GANs involves the following objective functions for the generator and discriminator:</p>
<ul>
<li><strong>Discriminator Loss</strong>:</li>
</ul>
<p>$$
L_D = - \mathbb{E}_{x \sim p_d(x)}[\log D(x)] -
$$</p>
<p>$$
\mathbb{E}_{z \sim p_z(z)}[\log (1 - D(G(z)))]
$$</p>
<ul>
<li><strong>Generator Loss</strong>:
$$
L_G = - \mathbb{E}_{z \sim p_z(z)}[\log D(G(z))]
$$</li>
</ul>
<p>where:</p>
<ul>
<li>( $D(x)$ ) is the discriminator&rsquo;s estimate of the probability that real data instance ( $x$ ) is real.</li>
<li>( $G(z)$ ) is the generator&rsquo;s output given noise ( $z$ ).</li>
<li>( $p_{d}(x)$ ) is the real data distribution.</li>
<li>( $p_z(z)$ ) is the prior distribution on input noise variables.</li>
</ul>
<p>Consider a simple GAN to generate <strong>handwritten digits similar to the MNIST dataset</strong>:</p>
<ol>
<li><strong>Generator Network</strong>: Takes random noise as input and generates a 28x28 image.</li>
<li><strong>Discriminator Network</strong>: Takes a 28x28 image as input and outputs a probability score indicating whether the image is real or fake.</li>
</ol>
<p>The networks are trained iteratively:</p>
<ol>
<li>Train the discriminator on real and fake images.</li>
<li>Train the generator to produce images that can fool the discriminator.</li>
</ol>
<p><img loading="lazy" src="/posts/gans/img6.jpeg" alt="GanMNIST"  />
</p>
<h3 id="cyclegan">CycleGAN<a hidden class="anchor" aria-hidden="true" href="#cyclegan">#</a></h3>
<p><strong>CycleGANs</strong> are a variant of GANs designed for image-to-image translation without <strong>requiring paired examples</strong>.
They are particularly useful for tasks where paired training data is unavailable.</p>
<h4 id="structure-of-cyclegans">Structure of CycleGANs<a hidden class="anchor" aria-hidden="true" href="#structure-of-cyclegans">#</a></h4>
<p>CycleGANs consist of two sets of generators and discriminators:</p>
<ul>
<li><strong>Generators</strong>: $( G: X \to Y )$ and $( F: Y \to X )$</li>
<li><strong>Discriminators</strong>: $( D_Y )$ and $( D_X )$, which evaluate the realism of generated images.</li>
</ul>
<p><img loading="lazy" src="/posts/gans/img8.png" alt="advloss"  />
</p>
<h4 id="loss-functions-in-cyclegans">Loss Functions in CycleGANs<a hidden class="anchor" aria-hidden="true" href="#loss-functions-in-cyclegans">#</a></h4>
<ol>
<li><strong>Adversarial Loss</strong>:</li>
</ol>
<p>$$
L_{GAN}(G, D_Y, X, Y) = \mathbb{E}_{y \sim p_d(y)}[\log (D_Y(y))] +
$$</p>
<p>$$
\mathbb{E}_{x \sim p_d(x)}[\log (1 - D_Y(G(x)))]
$$</p>
<ol start="2">
<li><strong>Cycle-Consistency Loss</strong>:</li>
</ol>
<p>$$
L_{cyc}(G, F) = \mathbb{E}_{x \sim p_d(x)}[| F(G(x)) - x |_1] +
$$</p>
<p>$$
\mathbb{E}_{y \sim p_d(y)}[| G(F(y)) - y |_1]
$$</p>
<p><img loading="lazy" src="/posts/gans/img9.png" alt="advloss"  />
</p>
<p><img loading="lazy" src="/posts/gans/img10.png" alt="advloss"  />
</p>
<ol start="3">
<li><strong>Total Loss</strong>:
$$
L(G, F, D_X, D_Y) = L_{GAN}(G, D_Y, X, Y) + L_{GAN}(F, D_X, Y, X) + \lambda L_{cyc}(G, F)
$$</li>
</ol>
<p>where $( \lambda )$ is a weight parameter that balances the two loss functions.</p>
<h4 id="example">Example<a hidden class="anchor" aria-hidden="true" href="#example">#</a></h4>
<p>Consider translating images from the domain of horses to the domain of zebras:</p>
<p><img loading="lazy" src="/posts/gans/img7.png" alt="cyclegans"  />
</p>
<ol>
<li><strong>Generator $( G )$</strong>: Transforms horse images to zebra images.</li>
<li><strong>Generator $( F )$</strong>: Transforms zebra images to horse images.</li>
<li><strong>Discriminator $( D_Y )$</strong>: Evaluates whether an image is a real zebra or generated by $( G )$.</li>
<li><strong>Discriminator $( D_X )$</strong>: Evaluates whether an image is a real horse or generated by $( F )$.</li>
</ol>
<p>The training process involves:</p>
<ol>
<li><strong>Minimizing the adversarial loss</strong> to ensure the generated images are indistinguishable from real images.</li>
<li><strong>Minimizing the cycle-consistency loss</strong> to ensure the content of the images is preserved during the translation.</li>
</ol>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://adilsarsenov.dev/tags/computer-vision/">Computer Vision</a></li>
      <li><a href="https://adilsarsenov.dev/tags/gans/">GANs</a></li>
      <li><a href="https://adilsarsenov.dev/tags/cyclegans/">CycleGANs</a></li>
      <li><a href="https://adilsarsenov.dev/tags/deep-learning/">Deep Learning</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2025 <a href="https://adilsarsenov.dev/">ASR</a></span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
